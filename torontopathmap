<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/jquery.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/raphael.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/jquery.mousewheel.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/system/site_images/photos/000/005/107/original/mallmaverick_svgmap.js?1412885524"></script>

<div class="map_container">
    <div class="main_container">
        <h4 class="map_heading">Toronto Path Map</h4>
        <div id="mapsvg_store_detail"></div>
    </div>
</div>

<script>
    $(document).ready(function(){
        loadMallDataCached(renderPageData);
    });
    
    function init_map(reg){
        map = $('#mapsvg_store_detail').mapSvg({
            source: getSVGMapURL(),    // Path to SVG map
            colors: {stroke: '#aaa', hover: '#EF4D86'},
            disableAll: true,
            regions: reg,
            tooltipsMode:'custom',
            loadingText: "loading...",
            zoom: true,
            zoomButtons: {'show': true,'location': 'right' },
            pan:true,
            panLimit:true,
            cursor:'pointer',
            responsive:true
        });
    }
    
    function renderPageData(){
        var stores = getStoresList();
        renderStoreList('#store_select_container','#store_select_template', stores);
        regions = {};
        $.each( stores , function( key, val ) {
            if(val.svgmap_region != null && typeof(val.svgmap_region)  != 'undefined'){
                obj = {};
                if(val.store_front_url_abs.indexOf('missing.png') > -1){
                    obj["tooltip"] = "<div class='tooltip_div'><p class='tooltip_name text-center'>"+val.name+"</p></div>"
                    obj["popover"] = "<p class='tooltip_name'>"+val.name+"</p>"
                }
                else{
                    obj["tooltip"] = "<div class='tooltip_div'><img src='" + val.store_front_url_abs + "'><p class='tooltip_name text-center'>"+val.name+"</p></div>"
                    obj["popover"] = "<div class='tooltip_div'><img src='" + val.store_front_url_abs + "'><p class='tooltip_name'>"+val.name+"</p></div>"
                }
                obj["attr"] = {}
                regions[val.svgmap_region] = obj
            }
        });
        $('#store_select_container').change(function(e){
            drop_pin($(this).val())
        })
        init_map(regions)
    }
</script>