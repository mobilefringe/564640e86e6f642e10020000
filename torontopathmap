<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/jquery.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/raphael.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/jquery.mousewheel.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/system/site_images/photos/000/005/107/original/mallmaverick_svgmap.js?1412885524"></script>

<div class="map_container">
    <div class="main_container">
        <h4 class="map_heading">Toronto Path Map</h4>
    </div>
</div>

<script>
    $(document).ready(function(){
        loadMallDataCached(renderPageData);
    });
    
    function renderPageData(){
        var stores = getStoresList();
        regions = {}
        $.each( stores , function( key, val ) {
            if(val.svgmap_region != null && typeof(val.svgmap_region)  != 'undefined'){
                if(!val.store_front_url_abs ||  val.store_front_url_abs.indexOf('missing.png') > -1 || val.store_front_url_abs.length === 0){
                    val.store_front_url_abs = 'http://assets.codecloudapp.com/sites/55ddf3f86e6f640775000000/a22fcf023d728855c6f575ba100806d7/default.jpg'
                } 
                obj = {};
                obj["popover"] = "<p class='tooltip_name'>"+val.name+"</p>"
                obj["attr"] = {}
                // obj["attr"]["href"] = "/stores/"+val.slug
                regions[val.svgmap_region] = obj
            }
        });
        renderStoreList('#stores_container','#stores_template', stores, "A", "Z");
        show_content();
        var map = $('#mapsvg_store_detail').mapSvg({
            source: getSVGMapURL(),
            colors: {stroke: '#fff', selected: "#DCBB8D", hover: "#a6a6a6"},
            disableAll: true,
            regions: regions,
            height:1700,
            width:2300,
            tooltipsMode:'custom',
            zoom:true,
            zoomButtons: {'show': true, 'location': 'left'},
            pan:true,
            cursor:'pointer',
            responsive:true,
            zoomLimit: [0,5]
        });
        
        $('.map_pin_a').click(function(e){
            e.preventDefault();
            var id = $(this).attr('data-value')
            map_pin(id)
        })
    }
        
    function map_pin(value){
        map.marksHide();
        value = value.split('/')
        if (value[0] != null){
            drop_pin(value[0], map);    
        }
    }
</script>