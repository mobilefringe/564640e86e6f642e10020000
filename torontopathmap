<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/jquery.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/raphael.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/javascripts/mapsvg/jquery.mousewheel.js"></script>
<script type="text/javascript" src="http://cdn.mallmaverick.com/system/site_images/photos/000/005/107/original/mallmaverick_svgmap.js?1412885524"></script>
<div class="map_container">
    <div class="main_container">
        <div class="row">
            <div class="col-md-12">
                <h4 class="map_heading">Toronto Path Map</h4> 
                <p>
                    We Love Downtown Toronto and the Toronto Path.  That is why we invested months to build our very own for all of Toronto to use.  Below is a sneak preview of the best Toronto Path Map ever made.  We have made it so easy to find out what stores are in the Path and how to get there.  The Toronto Path Map can be used on your iOS device by downloading our Shop Central App.
                </p>
                <p>
                    <a href="https://itunes.apple.com/ca/app/shop-central/id1055167722?mt=8" target="_blank">
                        <img src="http://assets.codecloudapp.com/sites/56ccc5a66e6f646cdd000000/image/png/1447445068000/apple.png" class="download_app margin_10_inline" alt="">
                    </a>
                </p>
                <p>
In the coming weeks we will be adding more amazing Toronto Path Map functionality for your Desktop and Mobile.  Including Toronto Path routing - find the best path from one store to another with directions.  Toronto Path Promotions and Events, and much more.  Download the app and stay tuned for more great Toronto Path map updates!
                </p>
                 <a class="show_phone" target="_blank" href="http://assets.codecloudapp.com/sites/56ccc5a66e6f646cdd000000/application/pdf/1474920770000/TorontoPath_map-min3.pdf" class="">
                    View Map
                </a>
            </div>
            <div class="col-md-12 show_pins hidden_phone">
                <select id="store_select_container" class="form-control pull-left" style="max-width:300px">
                    <option disabled selected>Select Store</option>
                    <script id="store_select_template" type="x-tmpl-mustache/text">
                        <option value='{{svgmap_region}}'>{{name}}</option>
                    </script>
                </select>
                <a href="#" id="clear_pins" class="newsletter_submit_btn">Clear Pin</a>
            </div>
        </div>
        <br />
        <img src="http://kodekloud.s3.amazonaws.com/sites/554a79236e6f64713f000000/69e8cd982124dc73de1f5a67a627ee75/loading.gif" class="loading_icon" alt="loading icon" />
        <div id="mapsvg_store_detail" class="hidden_phone"></div>
    </div>
</div>

<script>
    $(document).ready(function(){
        loadMallDataCached(renderPageData);
        $('.map_container').css('visibility', 'visible');
        $('#clear_pins').click(function(e){
            e.preventDefault();
            map.marksHide();
            $("#store_select_container").val($("#store_select_container option:first").val());
            map.setViewBox([0,0,4339, 5000]);
        })
        
    });
    function drop_pin(id){
        map.marksHide();
        var coords = map.get_coords(id);
        var height = parseInt(coords["height"]);
        var width = parseInt(coords["width"]);
        var x_offset = (parseInt(width) / 2);
        var y_offset = (parseInt(height) /2);
        map.setMarks([{ xy: [coords["x"] - 46 + x_offset, coords["y"] - 110 + y_offset],
            attrs: {
                src:  'http://assets.codecloudapp.com/sites/57b7340e6e6f644972020000/image/png/1452532624000/pin_93.png'
            }
        }]);
        map.setViewBox(id);
        $('#btnZoomIn').click()
        $('#btnZoomIn').click()
        $('#btnZoomIn').click()
        $('#btnZoomIn').click()
    }

    function init_map(reg){
        map = $('#mapsvg_store_detail').mapSvg({
            source: getSVGMapURL(),    // Path to SVG map
            colors: {stroke: '#fff', hover: '#EF4D86'},
            disableAll: true,
            regions: reg,
            tooltipsMode:'custom',
            loadingText: "loading...",
            zoom: true,
            zoomButtons: {'show': true,'location': 'right' },
            pan:true,
            panLimit:true,
            cursor:'pointer',
            responsive:true,
            zoomLimit: [0,10]
        });
    }
    
    function renderPageData(){
        
        var stores = getStoresList();
        renderStoreList('#store_select_container','#store_select_template', stores);
        regions = {};
        $.each( stores , function( key, val ) {
            if(val.svgmap_region != null && typeof(val.svgmap_region)  != 'undefined'){
                obj = {};
                if(val.store_front_url_abs.indexOf('missing.png') > -1){
                    obj["tooltip"] = "<div class='tooltip_div hidden_phone'><p class='tooltip_name text-center'>"+val.name+"</p></div>"
                }
                else{
                    obj["tooltip"] = "<div class='tooltip_div hidden_phone'><img src='" + val.store_front_url_abs + "'><p class='tooltip_name text-center'>"+val.name+"</p></div>"
                }
                obj["attr"] = {}
                regions[val.svgmap_region] = obj
            }
        });
        $('#store_select_container').change(function(e){
            drop_pin($(this).val())
        })
        if(detectmob() == false){
            init_map(regions)
        }
        $('.loading_icon').hide()
    }
    
    function detectmob() { 
        if( navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i)
        ){
            return true;
        }
        else {
            return false;
        }
    }
</script>